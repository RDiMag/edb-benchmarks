global
    maxconn 300
    log     /dev/log local0

defaults
    log global
    mode tcp
    retries 2
    timeout connect 1s
    timeout check 1s
    timeout server 30m
    timeout client 30m

listen postgres
    bind *:5444
    option httpchk GET /primary HTTP/1.0
    http-check expect status 200
    default-server inter 1s fall 3 rise 2 on-error mark-down on-marked-down shutdown-sessions

    {% for h in groups['primary'] -%}
    server {{ h }} {{ hostvars[h].private_ip }}:5444 maxconn 200 check port 5555
    {% endfor -%}
    {% for h in groups['standby'] -%}
    server {{ h }} {{ hostvars[h].private_ip }}:5444 maxconn 200 check port 5555
    {% endfor -%}
